(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a5e08bfc"],{"02d5":function(e,t,a){"use strict";var n=a("1a46"),i=a.n(n);i.a},"1a46":function(e,t,a){},bc47b:function(e,t,a){},cf1f:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-spin",{attrs:{spinning:e.confirmLoading}},[a("j-form-container",{attrs:{disabled:e.formDisabled}},[a("a-form-model",{ref:"form",attrs:{slot:"detail",model:e.model,rules:e.validatorRules},slot:"detail"},[a("a-row",[a("a-col",{attrs:{span:24}},[a("a-form-model-item",{attrs:{label:"联动名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol,prop:"linkageName"}},[a("a-input",{attrs:{placeholder:"请输入联动名称"},model:{value:e.model.linkageName,callback:function(t){e.$set(e.model,"linkageName",t)},expression:"model.linkageName"}})],1)],1),a("a-col",{attrs:{span:24}},[a("a-form-model-item",{attrs:{label:"联动动作",labelCol:e.labelCol,wrapperCol:e.wrapperCol,prop:"linkageAction"}},[a("j-multi-select-tag",{attrs:{type:"checkbox",dictCode:"linkage_action",placeholder:"请选择联动动作"},model:{value:e.model.linkageAction,callback:function(t){e.$set(e.model,"linkageAction",t)},expression:"model.linkageAction"}})],1)],1),a("a-col",{attrs:{span:24}},[a("a-form-model-item",{attrs:{label:"级别",labelCol:e.labelCol,wrapperCol:e.wrapperCol,prop:"linkageGrade"}},[a("j-dict-select-tag",{attrs:{type:"list",dictCode:"rank",placeholder:"请选择级别"},model:{value:e.model.linkageGrade,callback:function(t){e.$set(e.model,"linkageGrade",t)},expression:"model.linkageGrade"}})],1)],1),a("a-col",{attrs:{span:24}},[a("a-form-model-item",{attrs:{label:"描述",labelCol:e.labelCol,wrapperCol:e.wrapperCol,prop:"description"}},[a("a-input",{attrs:{placeholder:"请输入描述"},model:{value:e.model.description,callback:function(t){e.$set(e.model,"description",t)},expression:"model.description"}})],1)],1)],1)],1)],1),a("a-tabs",{on:{change:e.handleChangeTabs},model:{value:e.activeKey,callback:function(t){e.activeKey=t},expression:"activeKey"}},[a("a-tab-pane",{key:e.refKeys[0],attrs:{tab:"事件类型",forceRender:!0}},[a("j-editable-table",{ref:e.refKeys[0],attrs:{loading:e.affairTypeTable.loading,columns:e.affairTypeTable.columns,dataSource:e.affairTypeTable.dataSource,maxHeight:300,disabled:e.formDisabled,rowNumber:!0,rowSelection:!0,actionButton:!0}})],1)],1)],1)},i=[],r=(a("bc47b"),a("0fea")),o=a("e2e0"),l=a("7550"),s={components:{JEditableTable:l["default"]},data:function(){return{title:"操作",visible:!1,confirmLoading:!1,model:{},labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}},methods:{getAllTable:function(){var e=this;if(!(this.refKeys instanceof Array))throw this.throwNotArray("refKeys");var t=this.refKeys.map((function(t){return Object(o["c"])(e,t)}));return Promise.all(t)},eachAllTable:function(e){this.getAllTable().then((function(t){t.forEach((function(t,a){"function"===typeof e&&e(t,a)}))}))},add:function(){var e=this;return new Promise((function(t){e.tableReset(),t()})).then((function(){"function"===typeof e.addBefore&&e.addBefore();var t=e.addDefaultRowNum;"number"!==typeof t&&(t=1),e.eachAllTable((function(e){e.add(t)})),"function"===typeof e.addAfter&&e.addAfter(e.model),e.edit(e.model)}))},edit:function(e){e&&"{}"!=JSON.stringify(e)&&e.id&&this.tableReset(),"function"===typeof this.editBefore&&this.editBefore(e),this.visible=!0,this.activeKey=this.refKeys[0],this.$refs.form.resetFields(),this.model=Object.assign({},e),"function"===typeof this.editAfter&&this.editAfter(this.model)},close:function(){this.visible=!1,this.$emit("close")},tableReset:function(){this.eachAllTable((function(e){e.clearRow()}))},requestSubTableData:function(e,t,a,n){a.loading=!0,Object(r["c"])(e,t).then((function(e){var t=e.result,i=[];t&&(Array.isArray(t)?i=t:Array.isArray(t.records)&&(i=t.records)),a.dataSource=i,"function"===typeof n&&n(e)})).finally((function(){a.loading=!1}))},request:function(e){var t=this,a=this.url.add,n="post";this.model.id&&(a=this.url.edit,n="put"),this.confirmLoading=!0,Object(r["h"])(a,e,n).then((function(e){e.success?(t.$message.success(e.message),t.$emit("ok"),t.close()):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1}))},handleChangeTabs:function(e){Object(o["c"])(this,e).then((function(e){e.resetScrollTop()}))},handleCancel:function(){this.close()},handleOk:function(){var e=this;this.getAllTable().then((function(t){return Object(o["d"])(e.$refs.form,e.model,t)})).then((function(t){return e.validateSubForm(t)})).then((function(t){if("function"!==typeof e.classifyIntoFormData)throw e.throwNotFunction("classifyIntoFormData");var a=e.classifyIntoFormData(t);return e.request(a)})).catch((function(t){t.error===o["b"]&&(e.activeKey=null==t.index?e.activeKey:t.paneKey?t.paneKey:e.refKeys[t.index])}))},validateSubForm:function(e){return new Promise((function(t){t(e)}))},throwNotFunction:function(e){return"".concat(e," 未定义或不是一个函数")},throwNotArray:function(e){return"".concat(e," 未定义或不是一个数组")}}};a("ca00");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){d(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var u={name:"AffairLinkageForm",mixins:[s],components:{},data:function(){return{labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},labelCol2:{xs:{span:24},sm:{span:3}},wrapperCol2:{xs:{span:24},sm:{span:20}},model:{},addDefaultRowNum:1,validatorRules:{},refKeys:["affairType"],tableKeys:["affairType"],activeKey:"affairType",affairTypeTable:{loading:!1,dataSource:[],columns:[{title:"事件名称",key:"affairName",type:o["a"].select,dictCode:"type",width:"200px",placeholder:"请输入${title}",defaultValue:""},{title:"关联设备id",key:"equipmentId",type:o["a"].popup,popupCode:"equipment_ufpp",destFields:"equipmentId",orgFields:"id",width:"200px",placeholder:"请输入${title}",defaultValue:""},{title:"equipment_id",key:"equipment_id",type:"hidden"}]},url:{add:"/alarm/affairLinkage/add",edit:"/alarm/affairLinkage/edit",queryById:"/alarm/affairLinkage/queryById",affairType:{list:"/alarm/affairLinkage/queryAffairTypeByMainId"}}}},props:{disabled:{type:Boolean,default:!1,required:!1}},computed:{formDisabled:function(){return this.disabled}},created:function(){},methods:{addBefore:function(){this.affairTypeTable.dataSource=[]},getAllTable:function(){var e=this,t=this.tableKeys.map((function(t){return Object(o["c"])(e,t)}));return Promise.all(t)},editAfter:function(){if(this.$nextTick((function(){})),this.model.id){var e={id:this.model.id};this.requestSubTableData(this.url.affairType.list,e,this.affairTypeTable)}},validateSubForm:function(e){var t=this;return new Promise((function(a,n){Promise.all([]).then((function(){a(e)})).catch((function(e){e.error===o["b"]&&(t.activeKey=null==e.index?t.activeKey:t.refKeys[e.index])}))}))},classifyIntoFormData:function(e){var t=Object.assign(this.model,e.formValue);return f(f({},t),{},{affairTypeList:e.tablesValue[0].values})},validateError:function(e){this.$message.error(e)}}},p=u,m=(a("02d5"),a("2877")),b=Object(m["a"])(p,n,i,!1,null,"558c4fd2",null);t["default"]=b.exports}}]);